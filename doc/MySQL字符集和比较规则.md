## 字符集简介

我们知道在计算机中只能存储二进制数据，那该怎么存储字符串呢？当然是建立字符与二进制数据映射关系了，建立这个关系要搞清楚两件事：

1. 你要把哪些字符映射成二进制数据？  

也就是要清除字符范围

2. 怎么映射？  

 讲一个字符映射成一个二进制数据的过程也叫做编码，将一个二进制数据映射成字符的过程叫做解码。
 
 人们抽象出一个字符集的概念来描述某个字符范围的映射规则。
 
 ## 比较规则简介
 
 在我们确定了字符集的范围和编码规则之后，怎么比较两个字符串的大小呢？最容易想到的就是直接比较这两个字符对应的二进制编码的大小。这种简单的比较规则也被称为二进制比较规则，英文名为binary collate.
 
 二进制比较规则是简单，但是有时候并不符合现实需求，比如在很多场合对于英文字符我们都是不区分大小写的，也就是说"a"和"A"是相等的，在这种场合下就不能使用简单粗暴的二进制比较规则了，这时候我们可以这样
 指定比较规则：  
 
  1. 将两个大小写不同字符全都转为大写或者小写  
  2. 再比较这两个字符对应的二进制数据

这是一种稍微复杂一点点的比较规则，但是实际生活中的字符不止英文字符，比如我们的汉字有几万，对于某一种字符集来说，比较两个字符的大小可以指定多种规则，也就是说同一种字符集可以有多种比较规则。

## 一些重要的字符集

- ASCII 字符集   
  共收录128个字符，包括空格、标点符号、数字、大小写字母等。由于总共只有128个字符，所以需要一个字节来进行编码。
  ```
    'L' -> 01001100(十六进制 ：0x4C,十进制：76)
  ```

- ISO 8859-1字符集   
共收录256个字符，在 ASCII 基础上扩充了128个西欧常用的字符，也可以用一个字节来编码。

- GB2312字符集  
收录了汉字以及拉丁字母、希腊字母、日文平假名等，其中汉字6763个，其他文字符号682个。同时这种字符集又兼容ACSII，所以在编码方式上显得有些奇怪
   
   - 如何该字符在 ACSII 字符集中，则使用一个自己编码
   - 否则采用两个字节   


    这种表示一个字符需要的字节可能不同的编码方式称为“变长编码方式”，比如说字符串“爱u”，其中“爱”需要使用两个字节进行编码，而“u”需要一个字节进行编码。

    > 如何区分某个字节代表一个单独的字符还是字符的一部分呢？别忘了ASCII字符集只收录128个字符，使用1-127就可以表示全部字符，所以如果某个字节是在1-127之内的，就意味着一个字节代表单独的字符，否则就两个字节代表一个字符。

- GBK  
GBK 字符集只是在收录字符范围上对GB2312字符集进行了扩充，编码方式兼容GB2312

- UTF8字符集  
收录地球上能想到的所有字符，而且还在不断的扩充。这种字符集兼容ASCII字符集，采用变长编码方式，编码一个字符需要1-4个字节。

> 准确的说，utf8 只是 unicode 的字符集的一种编码方案，unicode 字符集可以采用 utf8,utf16,utf32这几种方案，utf8 使用1-4个字节编码一个字符，utf16使用2个或者4个字节编码一个字符，utf32使用4个字符编码一个字符。MySQl 中并不
区分字符集和编码方案的概念，所以可以把utf8、utf16、utf32当作一种字符集。

## MySQL 中支持的字符集和排序规则

### MySQL 中的utf8和utf8mb4

上面说到 utf8 字符集表示一个字符需要1-4个字节，但是我们常用的一些字符使用1-3个字节就可以表示了。而在 MySQL 中字符集表示一个字符串所使用最大字节长度在某些方面会影响系统的存储和性能，所有 MySQL 规定了两个概念：
- utf8mb3 ：阉割过的utf8，只使用1-3个字节
- utf8mb4 ：正宗的utf8，使用1-4个字节

在 M与SQL 中，utf8 是 utf8mb3的别名，所以在 MySQL 中提到的 utf8 意味着使用了1-3个字节，如果要存储 emoji 表情，那么就需要使用 utf8mb4

### 字符集的查看

```
#查看字符集
show charset

#查看比较规则
show collation
```

比较规则规律：_ci 结尾的表示不区分带小写， _cs 结尾的表示区分大小写 ，_bin 结尾的表示以二进制方式进行比较

## 字符集和比较规则的应用

### 各个级别的字符集和比较规则

MySQL 有四个字符集和比较规则，分别是：
- 服务器级别
- 数据库级别
- 表级别
- 列级别

### 服务器级别

MySQL 提供了两个系统变量来表示服务器的字符集和比较规则
```
# 服务器级别的字符集
show variables like '%character_set_server%'
# 服务器级别的比较规则
show variables like '%collation_server%'
```

### 数据库级别
```
# 数据级别的字符集
show variables like '%character_set_database%';

#比较规则
show variables like '%collation_database%';
```

### 表级别

```
create table test(
    ...

)character  set uft8 collate utf8_general_ci;

```
如果在创建表的时候没有指定字符集和比较规则，将使用数据库的字符集和比较规则

### 列级别
```
# 创建
create table test(
    col varchar character  set uft8 collate utf8_general_ci
    ...
)
# 修改
alter table test
modify ol varchar character  set uft8 collate utf8_general_ci
```
如果没有指定列的字符集和比较规则，将使用表的字符集和比较规则

### 仅修改字符集或仅修改比较规则
由于字符集和比较规则是相互联系的，如果我们只修改了字符集，比较规则也会跟着变化，如果只修改了比较规则，字符集也会跟着变化，具体规则如下：
- 只修改字符集，则比较规则将变为修改后的字符集默认的比较规则
- 只修改比较规则，则字符集将变为修改后的比较规则对应的字符集