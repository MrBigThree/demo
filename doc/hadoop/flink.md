## 场景

1. 构建实时数据仓库，  实时构建索引 ,事件驱动
2. 实时分析  数据分析
3. 数据驱动 data pipelines

## 时间窗口

### Flink 流处理的时间窗口

对于流处理系统来说，流入的消息是无限的，所以对于聚合或是连接等操作，流处理系统需要对流入的消息进行分段，然后基于每一段数据进行聚合或是连接等操作。
消息的分段即称为窗口，流处理系统支持的窗口有很多类型，最常见的就是时间窗口，基于时间间隔对消息进行分段处理。
对于目前大部分流处理系统来说，时间窗口一般是根据Task所在节点的本地时钟来进行分割，这种方式实现起来比较容易，不会阻塞消息处理。但是可能无法某些应用的要求。

Flink 支持三种类型的时间窗口，分别使用于对时间窗口不同类型的要求
1. Operator time 。根据 Task 所在节点的本地时钟来进行切分的时间窗口。
2. Event time 。消息自带时间戳，根据消息的时间戳进行处理，确保时间戳在同一个时间窗口的所有消息一定会被正确处理。由于消息可能是乱序流入 Task 的，所以Task 需要缓存当前时间窗口消息处理的状态，知道确认属于该时间窗口的消息全部被处理后，才可以释放其状态。
如果乱序消息的延迟很高，会影响分布式系统的吞吐量和延迟。
3. Ingress Time 。有时消息本身并不带有时间戳信息，但用仍然希望按照消息而不是节点时钟划分时间窗口。此时可以在消息源流入 Flink 系统时。自动生成增量的时间戳赋予消息，之后处理的流程和Event time 相同


#### Event Time 时间窗口的实现




